# CCTV Backend - Golang

Backend CCTV system menggunakan Golang + Fiber + SQLite.

## ğŸš€ Quick Start

### Prerequisites

- Go 1.21+
- SQLite3

### Installation

```bash
# Install dependencies
go mod download

# Copy environment variables
cp .env.example .env

# Run server
go run cmd/server/main.go
```

### Build

```bash
# Build binary
go build -o bin/server cmd/server/main.go

# Run binary
./bin/server
```

## ğŸ³ Docker

```bash
# Build image
docker build -t cctv-backend-go .

# Run container
docker run -p 3000:3000 --env-file .env cctv-backend-go
```

Or using Makefile:

```bash
make docker-build
make docker-run
```

## ğŸ“ Project Structure

```
.
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go              # Entry point
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go            # Configuration
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ database.go          # Database connection
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ user.go              # User model
â”‚   â”‚   â””â”€â”€ camera.go            # Camera model
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ auth.go              # JWT middleware
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â””â”€â”€ auth.go              # HTTP handlers
â”‚   â””â”€â”€ routes/
â”‚       â””â”€â”€ routes.go            # Route setup
â”œâ”€â”€ pkg/
â”‚   â””â”€â”€ logger/
â”‚       â””â”€â”€ logger.go            # Logger utility
â”œâ”€â”€ migrations/                  # SQL migrations
â”œâ”€â”€ go.mod                       # Dependencies
â”œâ”€â”€ Dockerfile                   # Docker build
â””â”€â”€ Makefile                     # Build commands
```

## ğŸ”§ Development

### Using Makefile

```bash
make build      # Build binary
make run        # Run server
make test       # Run tests
make clean      # Clean build artifacts
make fmt        # Format code
make lint       # Lint code
```

### Hot Reload

```bash
# Install air
go install github.com/cosmtrek/air@latest

# Run with hot reload
air
```

## ğŸ§ª Testing

```bash
# Run all tests
go test ./...

# With coverage
go test -cover ./...

# Verbose
go test -v ./...
```

## ğŸ“Š API Endpoints

### Public Endpoints

- `GET /health` - Health check
- `POST /api/auth/login` - User login
- `GET /api/cameras/active` - Get active cameras

### Protected Endpoints (Requires JWT)

- `POST /api/auth/logout` - User logout
- `GET /api/auth/verify` - Verify token
- `GET /api/cameras` - List all cameras
- `POST /api/cameras` - Create camera
- `PUT /api/cameras/:id` - Update camera
- `DELETE /api/cameras/:id` - Delete camera

## ğŸ” Environment Variables

```env
# Server
HOST=0.0.0.0
PORT=3000
NODE_ENV=development

# Database
DATABASE_PATH=./data/cctv.db

# JWT
JWT_SECRET=your-secret-key
JWT_EXPIRATION=24h

# Security
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000
API_KEY_SECRET=your-api-key-secret
CSRF_SECRET=your-csrf-secret

# MediaMTX
MEDIAMTX_API_URL=http://localhost:9997
MEDIAMTX_HLS_URL_INTERNAL=http://localhost:8888
PUBLIC_HLS_PATH=/hls
```

## ğŸ“ˆ Performance

Compared to Node.js version:

| Metric | Node.js | Golang | Improvement |
|--------|---------|--------|-------------|
| Memory | ~150 MB | ~20 MB | 7.5x |
| RPS | ~5,000 | ~50,000 | 10x |
| Latency | ~100ms | ~10ms | 10x |
| Image Size | ~200 MB | ~15 MB | 13x |

## ğŸ› ï¸ TODO

- [ ] Implement remaining controllers
  - [ ] Camera CRUD operations
  - [ ] Area management
  - [ ] Stream management
  - [ ] Recording management
- [ ] Add middleware
  - [ ] Rate limiting
  - [ ] CSRF protection
  - [ ] Input validation
- [ ] External integrations
  - [ ] MediaMTX API client
  - [ ] Telegram bot
  - [ ] Saweria webhook
- [ ] Background services
  - [ ] Camera health monitoring
  - [ ] Thumbnail generation
  - [ ] Session cleanup
- [ ] Testing
  - [ ] Unit tests
  - [ ] Integration tests
  - [ ] Load tests

## ğŸ“š Documentation

- [Migration Guide](../GOLANG_MIGRATION_GUIDE.md)
- [Migration Checklist](../migration-tools/MIGRATION_CHECKLIST.md)
- [Comparison](../migration-tools/COMPARISON.md)

## ğŸ¤ Contributing

1. Fork the repository
2. Create feature branch
3. Commit changes
4. Push to branch
5. Create Pull Request

## ğŸ“„ License

MIT License

## ğŸ†˜ Support

For issues and questions:
- Check documentation
- Open GitHub issue
- Contact maintainer

---

**Generated by**: Migration Tools
**Module**: github.com/abcdefak87/cctv
**Date**: 2026-02-08
